<ion-header>
  <ion-toolbar>
    <ion-buttons slot="end" (click)="dismissModal()"><ion-icon slot="icon-only" name="close"></ion-icon></ion-buttons>
    <ion-title>{{form.label}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-grid [formGroup]="templateForm" *ngIf="tableFields.length > 0" novalidate>
    <ion-row *ngIf="handleDisabeIf()">
      <ion-col *ngFor="let tableField of tableFields; let i = index" [ngClass]="getDivClass(tableField)" [id]="tableField._id" [size]="getColSize(tableField)" [size-sm]="" [size-md]="" [size-lg]="" [size-xl]="" >
        <div *ngIf="tableField.type == 'text'">
          <ion-item>
            <ion-label position="floating">{{ tableField.label }} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
            <ion-input [formControlName]="tableField.field_name" type="text" [required]="tableField.is_mandatory"></ion-input>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('maxlenght')">Maximum of {{ tableField.max_length }} characters</ion-note>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('minlength')">Minimum of {{ tableField.min_length }} characters</ion-note>
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'grid_selection'">
          <div>
            <ion-item *ngIf="tableField.add_list_field != 'add'">
              <ion-button expand="" size="small" fill="outline">{{ tableField.label}}
                <ion-text *ngIf="tableField.is_mandatory" class="mandatory"> * </ion-text> 
                <span *ngIf="tableField.add_list_field != 'add' " (click)="setValue('',tableField)" class="click_button_mask"></span> 
                <span *ngIf="tableField.add_list_field != 'add' " [innerHtml]="getNumberOfSelectedRecord(tableField)"></span>
              </ion-button>

              <ion-button expand="" size="small" fill="outline" [id]="tableField._id+'_'+tableField.field_name" *ngIf="tableField.add_list_field != 'add' && tableField.add_new_enabled" (click)="addListOfFields(tableField)">
                <ion-icon slot="icon-only" name="add-outline"></ion-icon>
              </ion-button>
              <ion-note slot="error" class="text-danger" *ngIf="this.custmizedFormValue[tableField.field_name] && this.custmizedFormValue[tableField.field_name].length == 0 &&
              templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>

              <!-- <ion-button expand="" size="small" fill="outline" [id]="tableField._id+'_'+tableField.field_name" *ngIf="custmizedFormValue[tableField.field_name] && custmizedFormValue[tableField.field_name].length > 0 && tableField.datatype == 'grid_review' && !tableField.is_disabled" (click)="reviewParameters(tableField,custmizedFormValue[tableField.field_name])">
                <ion-icon slot="icon-only" name="information-outline"></ion-icon>
              </ion-button> -->

            </ion-item>
          </div>
          <!-- <div *ngIf="samePageGridSelection == true" class="samePageGridSelection">
            <app-grid-selection [Data]="samePageGridSelectionData" (gridSelectionResponce) = "gridSelectionResponce($event)"></app-grid-selection>
          </div> -->
        </div>
        <div *ngIf="tableField.type == 'file'" class="camera_file_upload">
            <!-- <ion-list *ngIf="dataListForUpload[tableField.field_name] && dataListForUpload[tableField.field_name].length > 0">
              <ion-item *ngFor="let file of dataListForUpload[tableField.field_name]; let i = index;">
                <ion-thumbnail slot="start">
                  <ion-img [src]="'data:image/png;base64,'+file.fileData"></ion-img>
                </ion-thumbnail>
                <ion-label *ngIf="(file.rollName && file.rollName != null) || (file.fileName && file.fileName != null)">{{file.fileName || file.rollName}}</ion-label>
                <ion-button slot="end" class="" fill="clear" (click)="removeAttachedDataFromList(i,tableField.field_name)">
                  <ion-icon slot="icon-only" name="trash-outline" color=""></ion-icon>
                </ion-button>
                <ion-button slot="end" class="" fill="clear" (click)="imageDownload(file)">
                  <ion-icon slot="icon-only" name="download" color=""></ion-icon>
                </ion-button>
              </ion-item>
            </ion-list>
            <div class="ion-padding-start ion-padding-end">
              <input type="file" id="fileInput" [formControlName]="tableField.field_name" multiple (change)="fileBrowseHandler('',tableField,$event.target)" hidden="true" accept="image/*" />
              <ion-button expand="block" size="small" color="primary" fill="outline" (click)="selectImageSource('',tableField)" [formControlName]="tableField.field_name">{{ tableField.label }} <ion-icon slot="end" name="cloud-upload-outline"></ion-icon></ion-button>
            </div> -->
            <ion-accordion-group expand="inset">
              <ion-accordion value="{{tableField._id+'_'+tableField.field_name}}">
                <ion-item slot="header" color="light" line="inset">
                  <ion-label>{{ tableField.label | titlecase}} <ion-text *ngIf="tableField.is_mandatory" class="ng-star-inserted"> *</ion-text></ion-label>
                  <ion-button expand="round" slot="end" size="small" fill="outline" *ngIf="dataListForUpload[tableField.field_name] && dataListForUpload[tableField.field_name].length > 0" [innerHtml]="getNumberOfSelectedFile(tableField)"></ion-button>
                  <ion-button expand="round" slot="end" size="small" fill="outline" [id]="tableField._id+'_'+tableField.field_name" (click)="selectImageSource('',tableField)" [formControlName]="tableField.field_name" [disabled]="tableField.is_disabled">
                    <ion-icon slot="icon-only" name="cloud-upload-outline"></ion-icon>
                  </ion-button>
                  <!-- <input type="file" id="fileInput" [formControlName]="tableField.field_name" multiple (change)="fileBrowseHandler('',tableField,$event.target)" hidden="true" class="ion-hide" accept="image/*" /> -->
                </ion-item>
                <div class="ion-padding" slot="content" class="ion-padding-top">
                  <ion-item lines="none" class="ion-margin-bottom" *ngIf="!dataListForUpload[tableField.field_name] || (dataListForUpload[tableField.field_name] && dataListForUpload[tableField.field_name].length == 0)">
                    <ion-label>No file uploaded, <ion-text *ngIf="templateFormControl[tableField.field_name].errors ==null">please upload</ion-text> <ion-text slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].errors?.required">field is <strong>required</strong></ion-text></ion-label>
                  </ion-item>
                  <ion-list class="contactlist ion-margin-start ion-margin-end" *ngIf="dataListForUpload[tableField.field_name] && dataListForUpload[tableField.field_name].length > 0">
                    <ion-item class="ion-margin-bottom" *ngFor="let file of dataListForUpload[tableField.field_name]; let i = index;">
                      <!-- <ion-thumbnail slot="start">
                        <ion-img [src]="'data:image/png;base64,'+file.fileData"></ion-img>
                      </ion-thumbnail> -->
                      <ion-label *ngIf="(file.rollName && file.rollName != null) || (file.fileName && file.fileName != null)">{{file.fileName || file.rollName}}</ion-label>
                      <ion-label *ngIf="(!file.rollName && file.rollName == null) || (!file.fileName && file.fileName == null)">{{file._id}}</ion-label>
                      <ion-button slot="end" class="" fill="clear" (click)="removeAttachedDataFromList(i,tableField.field_name)">
                        <ion-icon slot="icon-only" name="trash-outline" color=""></ion-icon>
                      </ion-button>
                      <ion-button slot="end" class="" fill="clear" *ngIf="file && file._id" (click)="imageDownload(file)">
                        <ion-icon slot="icon-only" name="download" color=""></ion-icon>
                      </ion-button>
                    </ion-item>
                  </ion-list> 
                </div>
              </ion-accordion>
            </ion-accordion-group>
        </div>
        <div *ngIf="tableField.type == 'dropdown'">
          <ion-item *ngIf="tableField.datatype != 'object'">
            <ion-label position="floating">{{ tableField.label }} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
            <ion-select [selectedText]="templateForm.get(tableField.field_name).value" [formControlName]="tableField.field_name" (ionChange)="setValue('',tableField)" (ionCancel)="clearDropdownField($event, tableField)" cancel-text="Clear">
              <ion-select-option *ngFor="let staticValue of staticData[tableField.ddn_field]" [value]="staticValue" [innerHtml]="getddnDisplayVal(staticValue)"></ion-select-option>
              <ion-select-option *ngIf="tableField.add_new_enabled" [value]="{'_id':'tests','value':'add_new'}">+ Add New</ion-select-option>
            </ion-select>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">
              {{ tableField.label | titlecase}} is <strong>required</strong>
            </ion-note>
          </ion-item>
          <ion-item *ngIf="tableField.datatype == 'object'">
            <ion-label position="floating">{{ tableField.label }} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
            <ion-select [selectedText]="getddnDisplayVal(templateForm.get(tableField.field_name).value)" [formControlName]="tableField.field_name" [compareWith]="compareFn" (ionChange)="setValue('',tableField)" (ionCancel)="clearDropdownField($event, tableField)" cancel-text="Clear">
              <ion-select-option *ngFor="let staticValue of staticData[tableField.ddn_field]" [value]="staticValue" [innerHtml]="getddnDisplayVal(staticValue)"></ion-select-option>
              <ion-select-option *ngIf="tableField.add_new_enabled" [value]="{'_id':'tests','value':'add_new'}">+ Add New</ion-select-option>
            </ion-select>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">
              {{ tableField.label | titlecase}} is <strong>required</strong>
            </ion-note>
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'textarea'">
          <ion-item>
            <ion-label position="floating">{{ tableField.label }} <ion-text *ngIf="tableField.is_mandatory" class="ng-star-inserted"> *</ion-text></ion-label>
            <ion-textarea [formControlName]="tableField.field_name" [placeholder]="tableField.placeholder" [required]="tableField.is_mandatory" rows="3" cols="" auto-grow="true" enterkeyhint="enter" inputmode="text" spellcheck="true"></ion-textarea>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'number'">
          <ion-item>
            <ion-label position="floating">{{ tableField.label }} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
            <ion-input type="number" inputmode="numeric" [required]="tableField.is_mandatory" [formControlName]="tableField.field_name" [placeholder]="tableField.placeholder" (ionChange)="inputOnChangeFunc('',tableField)" (keyup)="inputOnChangeFunc('',tableField)" [id]="tableField._id+'_'+tableField.field_name" *ngIf="tableField.datatype != 'numberOnly' && tableField.datatype != 'mask'" [minlength]="tableField.min_length" [maxlength]="tableField.max_length"></ion-input>
            <ion-input type="tel" inputmode="numeric" [required]="tableField.is_mandatory" [formControlName]="tableField.field_name" [placeholder]="tableField.placeholder" (ionChange)="inputOnChangeFunc('',tableField)" (keyup)="inputOnChangeFunc('',tableField)" [id]="tableField._id+'_'+tableField.field_name" *ngIf="tableField.datatype == 'numberOnly'" [minlength]="tableField.min_length" [maxlength]="tableField.max_length"></ion-input>
            <ion-input type="tel" inputmode="numeric" [placeholder]="getTitlecase(tableField.placeholder)" [required]="tableField.is_mandatory" [formControlName]="tableField.field_name" *ngIf="tableField.datatype == 'mask'" [id]="tableField._id+'_'+tableField.field_name" autocomplete="off"></ion-input>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('maxlength')">Enter valid {{ tableField.label}} of {{ tableField.min_length }} characters</ion-note>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('minlength')">{{tableField.label}} should be {{ tableField.min_length }} characters</ion-note>
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'mobile'">
          <ion-item>
              <ion-label>{{ tableField.label | titlecase}} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
              <ion-input type="tel" inputmode="numeric" [placeholder]="getTitlecase(tableField.placeholder)" [required]="tableField.is_mandatory" [formControlName]="tableField.field_name" [minlength]="tableField.min_length" [maxlength]="tableField.max_length" OnlyNumber="true" [id]="tableField._id+'_'+tableField.field_name" autocomplete="off"></ion-input>
              <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
              <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('maxlength')">Enter valid {{ tableField.label}} of {{ tableField.min_length }} characters</ion-note>
              <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('minlength')">{{tableField.label}} should be {{ tableField.min_length }} characters</ion-note>
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'email'">
          <ion-item>
            <ion-label position="floating">{{ tableField.label }} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
            <ion-input type="email" inputmode="email" [formControlName]="tableField.field_name" [placeholder]="tableField.placeholder" [required]="tableField.is_mandatory" [id]="tableField._id+'_'+tableField.field_name"></ion-input>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.email">{{ tableField.label | titlecase}} address must be <strong>valid</strong></ion-note>
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'checkbox'">
          <ion-item>            
            <ion-checkbox  [formControlName]="tableField.field_name" [placeholder]="tableField.placeholder" (ionChange)="inputOnChangeFunc('',tableField)" [ngclass]="tableField.field_class" class="ion-margin-end"></ion-checkbox>
            <ion-label>{{ tableField.label }}</ion-label>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'radio'">
          <ion-list *ngIf="tableField.datatype != 'key_value'">
            <ion-radio-group [formControlName]="tableField.field_name" (ionChange)="inputOnChangeFunc('',tableField)">
              <ion-list-header>
                <ion-label>{{ tableField.label }}</ion-label>
              </ion-list-header>       
              <ion-item *ngFor="let staticValue of staticData[tableField.ddn_field]" >
                <ion-label [innerHtml]="getddnDisplayVal(staticValue)"></ion-label>
                <ion-radio slot="start" [value]="staticValue"></ion-radio>
                <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
              </ion-item>       
            </ion-radio-group>
          </ion-list>

          <ion-list *ngIf="tableField.datatype == 'key_value'">
            <ion-radio-group [formControlName]="tableField.field_name" (ionChange)="inputOnChangeFunc('',tableField)">
              <ion-list-header><ion-label>{{ tableField.label }}</ion-label></ion-list-header>       
              <ion-item *ngFor="let staticValue of staticData[tableField.ddn_field] | keyvalue">
                <ion-label [innerHtml]="getddnDisplayVal(staticValue.value)"></ion-label>
                <ion-radio slot="start" [value]="staticValue.key"></ion-radio>
              </ion-item>       
            </ion-radio-group>
          </ion-list>
        </div>
        <div *ngIf="tableField.type == 'label'">
          <ion-item lines="inset" class="form_label">
            <ion-label>{{ tableField.label }}</ion-label>
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'typeahead'">
          <div *ngIf="tableField.datatype == 'list_of_object'">
            <ng-select [multiple]="true" [placeholder]="tableField.label" [bindLabel]="'name'" [formControlName]="tableField.field_name" notFoundText="No records found" (keyup)="getTypeahead($event,'',tableField)" (change)="setValue('',tableField)">
              <ng-option *ngFor="let data of typeAheadData" [value]="data" [innerHtml]="getddnDisplayVal(data)"></ng-option>
            </ng-select>
          </div>
          <div *ngIf="tableField.datatype == 'chips'">
            <div class="ion-padding-horizontal">
              <ion-label position="stacked" class="chips-stacked-label">{{ tableField.label }} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
              <ion-chip  *ngFor="let item of custmizedFormValueData('',tableField); let i = index">
                <ion-label>{{getddnDisplayVal(item)}}</ion-label>
                <ion-icon name="close-outline" (click)="openModal('confirm-modal',i,'',tableField,item,'delete')"></ion-icon>
              </ion-chip>
            </div>
            <ng-select #chipsInput [bindLabel]="'name'" [formControlName]="tableField.field_name" notFoundText="No records found" (keyup)="getTypeahead($event,'',tableField)"  (change)="setValue('',tableField,true,chipsInput)" [readonly]="readonly">
              <ng-option *ngFor="let data of typeAheadData" [value]="data" [innerHtml]="getddnDisplayVal(data)"></ng-option>
            </ng-select> 
            <ion-note class="text-danger error ion-padding-horizontal" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">
                {{ tableField.label | titlecase}} is <strong>required</strong>
            </ion-note>         
          </div>
          <div *ngIf="tableField.datatype != 'list_of_object' && tableField.datatype != 'chips'">
            <ng-select [placeholder]="tableField.label" [bindLabel]="'name'" [formControlName]="tableField.field_name" notFoundText="No records found" (keyup)="getTypeahead($event,'',tableField)" (change)="setValue('',tableField)">
              <ng-option *ngFor="let data of typeAheadData" [value]="data" [innerHtml]="getddnDisplayVal(data)"></ng-option>
            </ng-select>
            <ion-note class="text-danger error ion-padding-horizontal" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">
              {{ tableField.label | titlecase}} is <strong>required</strong>
            </ion-note>
            <ion-note class="text-danger error ion-padding-horizontal" *ngIf="tableField.datatype == 'object' && templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.invaliData">
                {{ tableField.label | titlecase}} is <strong>invalidData</strong>
            </ion-note>
            <ion-note class="text-danger error ion-padding-horizontal" *ngIf="tableField.datatype == 'text' && templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.validDataText">
                {{ tableField.label | titlecase}} is <strong>invalidData</strong>
            </ion-note>
          </div>
        </div>
        <div *ngIf="tableField.type == 'date'">
          <ion-item>
            <ion-label>{{ tableField.label | titlecase}} <ion-text *ngIf="tableField.is_mandatory" class=""> *</ion-text></ion-label>
            <ion-input
              value="{{ templateForm.get(tableField.field_name).value | date: 'dd.MM.yyyy' }}"
              id="{{tableField._id + '_' + tableField.field_name}}"
              class="ion-text-end  ion-flex-direction-row-reverse"
              [required]="tableField.is_mandatory" (ionChange)="inputOnChangeFunc('',tableField)"
              [disabled]="tableField.is_disabled"
            >
              <ion-icon name="calendar-outline" class="ion-padding-start ion-icon-large-font"></ion-icon>
            </ion-input>
            <ion-note slot="error" class="text-danger" [ngClass]="templateFormControl[tableField.field_name].errors ? 'ion-show':'ion-hide'" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
            <ion-note slot="error" class="text-danger" [ngClass]="templateFormControl[tableField.field_name].errors ? 'ion-show':'ion-hide'" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.notValid">Your {{ tableField.label | titlecase}} is before <strong>Departure Date</strong></ion-note>

            <ion-popover trigger="{{tableField._id + '_' + tableField.field_name}}" >
              <ng-template>
                <ion-datetime
                  [id]="tableField.field_name + '_' + tableField._id"
                  size="cover"
                  presentation="date"
                  [formControlName]="tableField.field_name"
                  locale="en-US"
                  [min]="tableField.minDate"
                  [max]="tableField.maxDate"
                  show-clear-button="true"
                  [showDefaultButtons]="true"
                  [firstDayOfWeek]="1"
                  cancelText="Cancel"
                  doneText="Done"
                >
                <slot ></slot>
                </ion-datetime>
              </ng-template>
            </ion-popover>
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'gst_number'">
          <ion-item>
            <ion-label position="floating">{{ tableField.label }} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
            <ion-input [formControlName]="tableField.field_name" type="text" [required]="tableField.is_mandatory"></ion-input>
            <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.invalidGSTNumber">Entered {{ tableField.label | titlecase}} is <strong>invalid </strong></ion-note>       
          </ion-item>
        </div>
        <div *ngIf="tableField.type == 'list_of_string'">
          <ion-item class="chips" *ngIf="tableField.datatype == 'chips' || tableField.datatype == 'chips_with_mask'">
            <div class="w-100">
              <ion-label position="stacked" class="chips-stacked-label">{{ tableField.label }}</ion-label>
              <ion-chip *ngFor="let item of custmizedFormValueData('',tableField); let i = index;">
                <ion-label>{{getddnDisplayVal(item)}}</ion-label>
                <ion-icon name="close-outline" (click)="openModal('confirm-modal',i,'',tableField,item,'delete')"></ion-icon>
              </ion-chip>
              <ion-input [formControlName]="tableField.field_name" (keyup.enter)= "setValue('',tableField,true,$event)" enterkeyhint="done" (ionBlur)="setValue('',tableField,true,$event)"></ion-input>
            </div>
          </ion-item>
          <ion-item *ngIf="tableField.datatype != 'chips' && tableField.datatype != 'chips_with_mask'">
            <ion-label>{{ tableField.label }}</ion-label>
            <ion-chip *ngFor="let item of custmizedFormValueData('',tableField); let i = index;">
              <ion-label>{{getddnDisplayVal(item)}}</ion-label>
              <ion-icon name="close-outline" (click)="openModal('confirm-modal',i,'',tableField,item,'delete')"></ion-icon>
            </ion-chip>
            <ion-input type="text" [formControlName]="tableField.field_name" (keyup.enter)= "setValue('',tableField,true,$event)" enterkeyhint="done"></ion-input>
          </ion-item>
          <!-- <div *ngIf="tableField.type == 'list_of_string' && tableField.datatype != 'chips' && tableField.datatype != 'chips_with_mask'">
            <ion-reorder-group disabled="true" *ngIf="checkCustmizedFormValueData('',tableField)">
                <ion-item class="typeahead-example-box" *ngFor="let item of custmizedFormValueData('',tableField); let i = index">
                  <ion-reorder slot="start"></ion-reorder>
                  <ion-label>{{item}} <a (click)="openModal('confirm-modal',i,'',tableField,item,'delete')"><i class="fas fa-times"></i></a></ion-label>
                  <ion-icon slot="end" name="close-outline" (click)="openModal('confirm-modal',i,'',tableField,item,'delete')"></ion-icon>
                </ion-item>
            </ion-reorder-group>
          </div> -->
        </div>
        <div *ngIf="tableField.type == 'list_of_fields' || tableField.type == 'group_of_fields'">
          <ion-button expand="full" *ngIf="tableField.datatype != 'list_of_object_with_popup'">{{ tableField.label | titlecase}}</ion-button>
          <ion-accordion-group expand="inset" *ngIf="tableField.datatype == 'list_of_object_with_popup'">
            <ion-accordion value="{{tableField._id+'_'+tableField.field_name}}">
              <ion-item slot="header" color="light">
                <ion-label>{{ tableField.label | titlecase}} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
                <!-- <ion-button expand="round" slot="end" size="small" fill="outline" [id]="tableField._id+'_'+tableField.field_name" (click)="onClickLoadData('',tableField)" *ngIf="tableField.type == 'list_of_fields' && !tableField.add_list_field && tableField.add_list_field != 'add' && updateMode && tableField.onClickLoadData" [disabled]="custmizedFormValue[tableField.field_name] && custmizedFormValue[tableField.field_name].length > 0" [disabled]="tableField.is_disabled">
                  <ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
                </ion-button> -->
                <ion-button expand="round" slot="end" size="small" fill="outline" *ngIf="custmizedFormValue[tableField.field_name] && custmizedFormValue[tableField.field_name].length > 0" [innerHtml]="getNumberOfSelectedRecord(tableField)"></ion-button>
                <ion-button expand="round" slot="end" size="small" fill="outline" [id]="tableField._id+'_'+tableField.field_name" (click)="addListOfFields(tableField)" *ngIf="tableField.type == 'list_of_fields' && !tableField.add_list_field && tableField.add_list_field != 'add'" [disabled]="tableField.is_disabled">
                  <ion-icon slot="icon-only" name="add-outline"></ion-icon>
                </ion-button>
              </ion-item>
              <div class="ion-padding" slot="content" class="ion-padding-vertical">
                <ion-item lines="none" *ngIf="!custmizedFormValue[tableField.field_name] || (custmizedFormValue[tableField.field_name] && custmizedFormValue[tableField.field_name].length == 0)">
                  <ion-label>No data added, please add</ion-label>
                </ion-item>
                <ion-list class="contactlist ion-margin-start ion-margin-end" *ngFor="let listOfField of custmizedFormValue[tableField.field_name]; let i = index" [ngClass]="listOfField.status == 'I' ? 'd-none':''">
                  <!-- <ion-reorder-group (ionItemReorder)="doReorder($event,listOfField.id)" disabled="false"> -->
                    <ion-item-sliding class=" app-grid_selection">
                        <ion-item class="ion-no-margin" lines="none" (click)="updateListofFields(tableField,i)" *ngIf="tableField.list_of_fields">                          
                          <ion-col *ngFor="let fieldName of tableField.list_of_fields | slice:0:2; let j = index" [ngClass]="fieldName['type'] == 'numberOnly' || 'number' ? 'ion-text-end' : 'ion-text-start'">
                            <div *ngIf="fieldName && fieldName['type']">
                            <ion-label  *ngIf="fieldName && fieldName['type'] && (fieldName['type'] == 'date' || fieldName['type'] == 'text')" [innerHtml]="getValueForGrid(fieldName,listOfField)"></ion-label>
                            <ion-button *ngIf="fieldName && fieldName['type'] && (fieldName['type'] == 'numberOnly' || fieldName['type'] == 'number')" expand="round" color="success" [innerHtml]="getValueForGrid(fieldName,listOfField)"></ion-button>
                            </div>
                          </ion-col>
                        </ion-item>    
                        <ion-item-options side="end" *ngIf="!tableField.add_list_field && tableField.add_list_field != 'add'" >
                          <ion-item-option color="medium" class="pencil-outline" expandable *ngIf="tableField.datatype == 'list_of_object_with_popup'" (click)="updateListofFields(tableField,i)"><ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
                          </ion-item-option>
                          <ion-item-option color="medium" class="pencil-outline" expandable *ngIf="tableField.datatype != 'list_of_object_with_popup'" (click)="editListOfFiedls(listOfField,i)"><ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
                          </ion-item-option>
                          <ion-item-option color="danger" class="trash-outline" expandable (click)="openModal('confirm-modal',i,'',tableField,listOfField,'delete')"><ion-icon slot="icon-only" name="trash-outline"></ion-icon>
                          </ion-item-option>
                        </ion-item-options>
                    </ion-item-sliding>
                  <!-- </ion-reorder-group> -->
                </ion-list> 
              </div>
            </ion-accordion>
          </ion-accordion-group>
          
          <div class="row align-items-center" [formGroupName]="tableField.field_name" *ngIf="tableField.list_of_fields != null && tableField.datatype != 'list_of_object_with_popup'">
              <div  *ngFor="let fields of tableField.list_of_fields; let i = index" [ngClass]="getDivClass(fields)" [id]="fields._id">
                  <div *ngIf="fields.type == 'text'">
                      <ion-item>
                        <ion-label position="floating">{{ fields.label | titlecase }} <ion-text *ngIf="fields.is_mandatory" class=""> *</ion-text></ion-label>
                        <ion-input type="text" [placeholder]="getTitlecase(fields.placeholder)"  [formControlName]="fields.field_name" *ngIf="fields.datatype != 'first_cap'" [id]="fields._id+'_'+fields.field_name" [required]="fields.is_mandatory"></ion-input>
                        <ion-input type="text" [placeholder]="getTitlecase(fields.placeholder)"  [formControlName]="fields.field_name" appTitleCase *ngIf="fields.datatype == 'first_cap'" [id]="fields._id+'_'+fields.field_name" [required]="fields.is_mandatory"></ion-input>
                        <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
                        <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('maxlenght')">Maximum of {{ tableField.max_length }} characters</ion-note>
                        <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('minlength')">Minimum of {{ tableField.min_length }} characters</ion-note>
                      </ion-item>
                  </div>
                  <div *ngIf="fields.type == 'password'">
                      <ion-item appearance="outline" class="example-full-width w-100">
                          <ion-label>{{ fields.label | titlecase}}<ion-text *ngIf="fields.is_mandatory" class="ng-star-inserted"> *</ion-text></ion-label>
                          <input [type]="hide ? 'password' : 'text'" [placeholder]="getTitlecase(fields.placeholder)"   [formControlName]="fields.field_name" [id]="fields._id+'_'+fields.field_name">
                          <ion-button (click)="hide = !hide">
                            <ion-icon slot="end" [name]="hide ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
                          </ion-button>
                      </ion-item>
                  </div>
                  <div *ngIf="fields.type == 'email'">
                      <ion-item appearance="outline" class="example-full-width w-100">
                          <ion-label>{{ fields.label | titlecase}} <ion-text *ngIf="tableField.is_mandatory"> *</ion-text></ion-label>
                          <ion-input type="email" [placeholder]="getTitlecase(fields.placeholder)" [formControlName]="fields.field_name" [required]="fields.is_mandatory" [id]="fields._id+'_'+fields.field_name"></ion-input>
                          <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
                          <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.email">{{ tableField.label | titlecase}} address must be <strong>valid</strong></ion-note>
                      </ion-item>                            
                  </div>
                  <div *ngIf="fields.type == 'date'">
                      <ion-item>
                          <ion-label>{{ fields.label | titlecase}}<ion-text *ngIf="fields.is_mandatory" class="ng-star-inserted"> *</ion-text></ion-label>
                          <ion-input type="date"
                            [id]="fields._id + '_' + fields.field_name"
                            class="ion-text-end  ion-flex-direction-row-reverse--"
                            [required]="fields.is_mandatory" (ionChange)="inputOnChangeFunc('',fields)"
                            [disabled]="fields.is_disabled"
                            [formControlName]="fields.field_name"
                            [min]="fields.minDate"
                            [max]="fields.maxDate"
                            pattern="\d{4}-\d{2}-\d{2}"
                          >
                          </ion-input>
                      </ion-item>
                  </div>
                  <div *ngIf="fields.type == 'number'">
                    <ion-item>
                      <ion-label position="floating">{{ fields.label | titlecase}} <ion-text *ngIf="fields.is_mandatory" class=""> *</ion-text></ion-label>
                      <ion-input type="number" inputmode="numeric || tel" [placeholder]="getTitlecase(fields.placeholder)"  [formControlName]="fields.field_name" (keyup)="inputOnChangeFunc(tableField,fields)" *ngIf="fields.datatype != 'text' && fields.datatype != 'numberOnly'" [id]="fields._id+'_'+fields.field_name"></ion-input>
                      <ion-input type="tel" inputmode="numeric || tel" [placeholder]="getTitlecase(fields.placeholder)"  [formControlName]="fields.field_name" [minlength]="fields.min_length" [maxlength]="fields.max_length" *ngIf="fields.datatype == 'text'" [id]="fields._id+'_'+fields.field_name"></ion-input>
                      <ion-input type="tel" inputmode="numeric || tel" [placeholder]="getTitlecase(fields.placeholder)"  [formControlName]="fields.field_name" NumberOnly="true" (keyup)="inputOnChangeFunc(tableField,fields)" *ngIf="fields.datatype == 'numberOnly'" [id]="fields._id+'_'+fields.field_name"></ion-input>
                      <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].errors?.required">{{ tableField.label | titlecase}} is <strong>required</strong></ion-note>
                      <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('maxlength')">Enter valid {{ tableField.label}} of {{ tableField.min_length }} characters</ion-note>
                      <ion-note slot="error" class="text-danger" *ngIf="templateFormControl[tableField.field_name].touched && templateFormControl[tableField.field_name].hasError('minlength')">{{tableField.label}} should be {{ tableField.min_length }} characters</ion-note>
                    </ion-item>
                  </div>
                  <div *ngIf="fields.type == 'textarea'">
                      <ion-item appearance="outline" class="example-full-width w-100">
                          <ion-label position="floating">{{ fields.label | titlecase}} <ion-text *ngIf="tableField.is_mandatory" class="ng-star-inserted"> *</ion-text></ion-label>
                          <ion-textarea [placeholder]="getTitlecase(fields.placeholder)" [required]="fields.is_mandatory" [formControlName]="fields.field_name" [disabled]="fields.is_disabled" rows="3" cols="" auto-grow="true" enterkeyhint="enter" inputmode="text" spellcheck="true"></ion-textarea>                
                      </ion-item>
                  </div>
              </div>
              <div [ngClass]="tableField.etc_fields && tableField.etc_fields.btn_class ? tableField.etc_fields.btn_class:'col-lg-3'" *ngIf="tableField.type == 'list_of_fields'">
                  <ion-button size="small" shape="round" class=""  (click)="setValue('',tableField,false)">
                    <ion-icon slot="icon-only" icon="add-outline" *ngIf="!listOfFieldUpdateMode"></ion-icon>
                    <ion-icon slot="icon-only" icon="pencil-outline" *ngIf="listOfFieldUpdateMode"></ion-icon>
                  </ion-button>
                  <ion-button size="small" shape="round" class="" (click)="refreshListofField(tableField,false)">
                    <ion-icon slot="icon-only" icon="refresh-outline"></ion-icon>
                  </ion-button>
              </div>
          </div>
          
          <div class="" *ngIf="tableField.type == 'list_of_fields' && tableField.datatype != 'key_value'">
            <div class="ion-table-responsive-x ion-margin-vertical ion-padding" *ngIf="custmizedFormValue[tableField.field_name]">
                <table class="table-bordered table-striped table-hover one-line-text" *ngIf="custmizedFormValue[tableField.field_name].length > 0">
                    <thead>
                        <tr>
                            <th width="10%" style="text-align: center" *ngIf="!tableField.add_list_field && tableField.add_list_field != 'add'">Action</th>
                            <th *ngFor="let item of getListOfFieldsGridColumn(tableField)" [ngClass]="item.hide_in_inline_grid  || checkShowIfListOfFiedlds(tableField,item,0) ? 'd-none' : ''">{{item.label}}</th>                                                
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let listOfField of custmizedFormValue[tableField.field_name]; let i = index" [ngClass]="listOfField.status == 'I' ? 'd-none':''">
                            <td class="px-1" style="text-align: center" *ngIf="!tableField.add_list_field && tableField.add_list_field != 'add'">
                                <a  floating="true" size="sm" *ngIf="tableField.datatype == 'list_of_object_with_popup' && checkRowDisabledIf(tableField,i)" (click)="updateListofFields(tableField,i)" class="grid-button"><span class="material-symbols-outlined" >edit</span></a>

                                <a floating="true" size="sm" *ngIf="tableField.datatype != 'list_of_object_with_popup' && checkRowDisabledIf(tableField,i)" (click)="editListOfFiedls(listOfField,i)" class="grid-button"><span class="material-symbols-outlined" >edit</span></a>
                                
                                <a *ngIf="checkRowDisabledIf(tableField,i)" floating="true" size="sm" (click)="openModal('confirm-modal',i,'',tableField,listOfField,'delete')" class="grid-button removebtn"><span class="material-symbols-outlined">close</span></a>                        
                            </td>
                            <td *ngFor="let item of getListOfFieldsGridColumn(tableField)" [ngClass]="item.hide_in_inline_grid  || checkShowIfListOfFiedlds(tableField,item,i) ? 'd-none' : 'ion-text-center'" (click)="showListOfFieldData(listOfField, item)" [innerHtml]="showListFieldValue(listOfField, item)"></td>                                                
                        </tr>
                    </tbody>
                </table>
            </div>
          </div>

        </div>
        <div class="grid-selection" *ngIf="tableField.type == 'grid_selection_vertical'">
          <ion-item-divider>
            <ion-row class="w-100">
              <ion-col size="9"><ion-label>{{ tableField.label }}</ion-label></ion-col>
              <ion-col size="3">
                <ion-button shape="round" *ngIf="tableField.datatype != 'grid_review' && !tableField.is_disabled" (click)="setValue('',tableField,false)" [disabled]="templateFormControl[tableField.field_name].disabled"><ion-icon name="chevron-down-outline"></ion-icon></ion-button>
                <ion-button shape="round" *ngIf="custmizedFormValue[tableField.field_name] && custmizedFormValue[tableField.field_name].length > 0 && tableField.datatype == 'grid_review' && !tableField.is_disabled" (click)="reviewParameters(tableField,custmizedFormValue[tableField.field_name])" [disabled]="templateFormControl[tableField.field_name].disabled"><ion-icon name="time-outline"></ion-icon></ion-button>
              </ion-col>
            </ion-row>
          </ion-item-divider>

           <table>
              <tbody>
              <tr *ngFor="let fieldName of modifiedGridColumns(tableField.gridColumns)" [ngClass]="fieldName.display ? 'ml-1':'d-none'">
                  <td >{{ fieldName.label | titlecase}}</td>
                  <td *ngFor="let data of custmizedFormValue[tableField.field_name]; let i = index">
                          <span disabled *ngIf="fieldName.type=='checkbox'" >
                              <mat-checkbox color="primary"[checked]="data[fieldName.field_name]" disabled></mat-checkbox>
                          </span>
                      <span *ngIf="fieldName.type!='checkbox'" [innerHtml]="getValueForGrid(fieldName,data)"></span>
                  </td>
              </tr>
              </tbody>
          </table>

        </div>
        <div *ngIf="tableField.type == 'html_view'">
          <angular-editor [formControlName]="tableField.field_name" [config]="htmlViewConfig"></angular-editor>                          
        </div>
      </ion-col> 
      
      <ion-col *ngIf="samePageGridSelection == true" class="samePageGridSelection">
        <app-grid-selection [Data]="samePageGridSelectionData" (gridSelectionResponce) = "gridSelectionResponce($event)"></app-grid-selection>
      </ion-col>
    </ion-row>  
    
    <ion-row>
      <ion-col>
        <span *ngFor="let action_button of formFieldButtons; let i=index" class="w-100" [ngClass]="getButtonDivClass(action_button)" [id]="action_button._id">
          <ion-button type="button" *ngIf="action_button.type == 'button'" (click)="take_action_on_click(action_button)" color="danger" [disabled]="checkValidator(action_button)" expand="block">{{nextFormUpdateMode && action_button.onclick.api == 'add' ? 'Update':action_button.label}}</ion-button>          
        </span>
      </ion-col>
    </ion-row>
    
  </ion-grid>
</ion-content>